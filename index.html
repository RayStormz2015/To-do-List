<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My To-Do List</title>

<style>
    * {
        box-sizing: border-box;
        touch-action: manipulation;
    }

    body {
        font-family: Arial, sans-serif;
        padding: 16px;
        max-width: 600px;
        margin: auto;
    }

    h1 {
        text-align: center;
        margin-bottom: 20px;
    }

    p {
        font-size: 20px;
    }

    ul {
        list-style: none;
        padding: 0;
    }

    li {
        margin: 12px 0;
        padding: 14px;
        background-color: #f4f4f4;
        border-radius: 10px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        font-size: 18px;

        /* animation base */
        opacity: 0;
        transform: translateY(15px) scale(0.98);
        transition: opacity 0.35s ease, transform 0.35s ease;
        will-change: transform, opacity;
    }

    li.show {
        opacity: 1;
        transform: translateY(0) scale(1);
    }

    li.remove {
        opacity: 0;
        transform: translateX(-20px) scale(0.95);
    }

    .btnRow {
        display: flex;
        gap: 10px;
    }

    button {
        flex: 1;
        min-height: 44px;
        font-size: 16px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: transform 0.15s ease;
    }

    button:active {
        transform: scale(0.95);
    }

    button.deadlineBtn {
        background-color: #333;
        color: white;
    }

    button.clearBtn {
        background-color: red;
        color: white;
    }

    input {
        width: 100%;
        padding: 12px;
        font-size: 16px;
        border-radius: 8px;
        border: 1px solid #ccc;
        margin-bottom: 10px;
    }

    button#addBtn {
        width: 100%;
        padding: 14px;
        font-size: 18px;
        background-color: #007bff;
        color: white;
        border-radius: 10px;
    }
</style>

<link rel="icon" href="favicon.png" type="image/png">
</head>

<body>

<h1>My To-Do List</h1>

<ul id="tasklist"></ul>

<p>Add your task:</p>
<input type="text" id="newTask" placeholder="Type your task here">
<button id="addBtn">Add Task</button>

<script>
Notification.requestPermission();

const input = document.getElementById("newTask");
const addBtn = document.getElementById("addBtn");
const list = document.getElementById("tasklist");

let tasks = JSON.parse(localStorage.getItem("tasks")) || [];
let deadlines = JSON.parse(localStorage.getItem("deadlines")) || {};

// unified pointer handler
function onPress(element, handler) {
    element.addEventListener("pointerdown", (e) => {
        e.preventDefault();
        handler(e);
    });
}

function createTask(taskText) {
    const li = document.createElement("li");

    const text = document.createElement("div");
    text.textContent = taskText;

    const btnRow = document.createElement("div");
    btnRow.className = "btnRow";

    const deadlineBtn = document.createElement("button");
    deadlineBtn.textContent = "Set Deadline";
    deadlineBtn.className = "deadlineBtn";

    onPress(deadlineBtn, () => {
        alert("IMPORTANT: Keep this tab open for notifications.");
        const time = prompt("Enter deadline (YYYY-MM-DD HH:MM)");
        if (!time) return;

        const timestamp = new Date(time).getTime();
        if (isNaN(timestamp)) {
            alert("Invalid date.");
            return;
        }

        deadlines[taskText] = timestamp;
        localStorage.setItem("deadlines", JSON.stringify(deadlines));
        alert("Deadline set!");
    });

    const clearBtn = document.createElement("button");
    clearBtn.textContent = "Clear Task";
    clearBtn.className = "clearBtn";

    onPress(clearBtn, () => {
        if (!confirm("Clear this task?")) return;

        li.classList.add("remove");

        setTimeout(() => {
            list.removeChild(li);
        }, 350);

        tasks = tasks.filter(t => t !== taskText);
        delete deadlines[taskText];

        localStorage.setItem("tasks", JSON.stringify(tasks));
        localStorage.setItem("deadlines", JSON.stringify(deadlines));
    });

    btnRow.appendChild(deadlineBtn);
    btnRow.appendChild(clearBtn);

    li.appendChild(text);
    li.appendChild(btnRow);
    list.appendChild(li);

    requestAnimationFrame(() => {
        li.classList.add("show");
    });
}

// load saved tasks with animation
tasks.forEach(createTask);

onPress(addBtn, () => {
    const taskText = input.value.trim();
    if (!taskText) return;

    tasks.push(taskText);
    localStorage.setItem("tasks", JSON.stringify(tasks));

    createTask(taskText);
    input.value = "";
});

setInterval(() => {
    const now = Date.now();

    for (let task in deadlines) {
        if (now >= deadlines[task]) {
            new Notification("Task Reminder!", { body: task });
            delete deadlines[task];
            localStorage.setItem("deadlines", JSON.stringify(deadlines));
        }
    }
}, 1000);
</script>

</body>
</html>
