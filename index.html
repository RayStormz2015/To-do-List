<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My To-Do List</title>
<link rel="icon" type="image/png" href="favicon.png">

<style>
* {
    box-sizing: border-box;
    touch-action: manipulation;
}

body {
    font-family: Arial, sans-serif;
    padding: 16px;
    max-width: 600px;
    margin: auto;
}

h1 {
    text-align: center;
    margin-bottom: 10px;
}

.syncBox {
    background: #eee;
    padding: 12px;
    border-radius: 10px;
    margin-bottom: 15px;
}

.syncBox button {
    width: 100%;
    margin-top: 8px;
}

p {
    font-size: 20px;
}

ul {
    list-style: none;
    padding: 0;
}

li {
    --swipeX: 0px;
    margin: 12px 0;
    padding: 14px;
    background-color: #f4f4f4;
    border-radius: 10px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    font-size: 18px;
    opacity: 0;
    transform: translateY(15px) scale(0.98) translateX(var(--swipeX));
    transition: transform 0.3s ease, opacity 0.3s ease;
}

li.show {
    opacity: 1;
    transform: translateY(0) scale(1) translateX(var(--swipeX));
}

li.remove {
    opacity: 0;
    transform: translateX(-120%) scale(0.95);
}

.btnRow {
    display: flex;
    gap: 10px;
}

button {
    min-height: 44px;
    font-size: 16px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
}

.clearBtn {
    background-color: red;
    color: white;
}

input {
    width: 100%;
    padding: 12px;
    font-size: 16px;
    border-radius: 8px;
    border: 1px solid #ccc;
    margin-bottom: 10px;
}

#addBtn {
    padding: 14px;
    font-size: 18px;
    background-color: #007bff;
    color: white;
    border-radius: 10px;
}
</style>
</head>

<body>

<h1>My To-Do List</h1>

<!-- ðŸ”— SYNC CONTROLS -->
<div class="syncBox">
    <strong>Sync</strong>
    <div id="syncCodeDisplay"></div>
    <button onclick="generateSyncCode()">Generate Sync Code</button>
    <button onclick="enterSyncCode()">Enter Sync Code</button>
    <button onclick="stopSync()">Stop Sync</button>
</div>

<ul id="tasklist"></ul>

<p>Add your task:</p>
<input id="newTask" placeholder="Type your task here">
<button id="addBtn">Add Task</button>

<script>
/* =======================
   ðŸ”— SYNC CONFIG
======================= */
const SERVER = "http://localhost:3000"; // your backend
let syncId = localStorage.getItem("syncId");

/* =======================
   ðŸ§  LOAD TASKS
======================= */
let tasks = [];

async function loadTasks() {
    if (!syncId) {
        tasks = JSON.parse(localStorage.getItem("tasks")) || [];
        render();
        return;
    }

    const res = await fetch(`${SERVER}/load/${syncId}`);
    tasks = await res.json();
    localStorage.setItem("tasks", JSON.stringify(tasks));
    render();
}

/* =======================
   ðŸ’¾ SAVE TASKS
======================= */
function saveTasks() {
    localStorage.setItem("tasks", JSON.stringify(tasks));

    if (syncId) {
        fetch(`${SERVER}/save`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ syncId, data: tasks })
        });
    }
}

/* =======================
   ðŸ” SYNC CODE LOGIC
======================= */
function generateSyncCode() {
    syncId = crypto.randomUUID(); // strong & unguessable
    localStorage.setItem("syncId", syncId);
    alert("Your Sync Code:\n\n" + syncId);
    updateSyncUI();
    saveTasks();
}

function enterSyncCode() {
    const code = prompt("Enter Sync Code:");
    if (!code) return;
    syncId = code.trim();
    localStorage.setItem("syncId", syncId);
    updateSyncUI();
    loadTasks();
}

function updateSyncUI() {
    document.getElementById("syncCodeDisplay").textContent =
        syncId ? "Connected with sync code" : "Not synced";
}

function stopSync() {
    const confirmed = confirm(
        "Stop syncing on this device?\n\nYour tasks will remain locally."
    );
    if (!confirmed) return;

    // Remove sync link
    localStorage.removeItem("syncId");

    // Keep tasks locally
    localStorage.setItem("tasks", JSON.stringify(tasks));

    syncId = null;
    updateSyncUI();

    alert("Sync stopped on this device.");
}

/* =======================
   ðŸ“ TODO LOGIC (UNCHANGED)
======================= */
const input = document.getElementById("newTask");
const addBtn = document.getElementById("addBtn");
const list = document.getElementById("tasklist");

function render() {
    list.innerHTML = "";
    tasks.forEach(createTask);
}

function createTask(text) {
    const li = document.createElement("li");
    li.textContent = text;

    const btn = document.createElement("button");
    btn.textContent = "Clear Task";
    btn.className = "clearBtn";

    btn.onclick = () => {
        if (!confirm("Clear this task?")) return;
        tasks = tasks.filter(t => t !== text);
        saveTasks();
        render();
    };

    li.appendChild(btn);
    list.appendChild(li);
    requestAnimationFrame(() => li.classList.add("show"));
}

addBtn.onclick = () => {
    const text = input.value.trim();
    if (!text) return;
    tasks.push(text);
    saveTasks();
    createTask(text);
    input.value = "";
};

/* =======================
   ðŸš€ INIT
======================= */
updateSyncUI();
loadTasks();
</script>

</body>
</html>

