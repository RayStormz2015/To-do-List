<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My To-Do List</title>
<style>
    body {
        font-family: Arial, sans-serif;
        padding: 20px;
    }
    h1 {
        text-align: center;
    }
    p {
        font-size: 22px;
    }
    ul {
        list-style: none;
        padding: 0;
    }
    li {
        margin: 7px 0;
        padding: 8px;
        background-color: #f4f4f4;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-radius: 5px;
    }
    button.clearBtn {
        margin-left: 10px;
        background-color: red;
        color: white;
        border: none;
        padding: 5px 8px;
        cursor: pointer;
        border-radius: 5px;
    }
    button.deadlineBtn {
        margin-left: 10px;
        background-color: #333;
        color: white;
        border: none;
        padding: 5px 8px;
        cursor: pointer;
        border-radius: 5px;
    }
    input {
        padding: 5px;
        width: 220px;
        margin-right: 10px;
    }
    button#addBtn {
        padding: 5px 10px;
        cursor: pointer;
    }
</style>
<link rel="icon" href="Flex_Widgets_Logo-removebg-preview.png" type="image/png">
</head>
<body>

<h1>My To-Do List</h1>

<ul id="tasklist"></ul>

<p>Add your task here:</p>
<input type="text" id="newTask" placeholder="Type your task here.">
<button id="addBtn">Add Task</button>

<script>
// Ask for notification permission
Notification.requestPermission();

// References
const input = document.getElementById("newTask");
const button = document.getElementById("addBtn");
const list = document.getElementById("tasklist");

// Load saved tasks + deadlines
let tasks = JSON.parse(localStorage.getItem("tasks")) || [];
let deadlines = JSON.parse(localStorage.getItem("deadlines")) || {}; // task -> timestamp

// Create a task <li>
function createTask(taskText) {
    const li = document.createElement("li");
    li.textContent = taskText;

    // Create "Create Deadline" button
    const deadlineBtn = document.createElement("button");
    deadlineBtn.textContent = "Create Deadline";
    deadlineBtn.className = "deadlineBtn";

    deadlineBtn.addEventListener("click", function () {
        alert("IMPORTANT: If you want to be notified for your tasks, please keep this browser tab open.");
        const time = prompt("Enter deadline (YYYY-MM-DD HH:MM)\nExample: 2025-12-09 18:00");
        if (!time) return;

        let timestamp = new Date(time).getTime();
        if (isNaN(timestamp)) {
            alert("Invalid format.");
            return;
        }

        deadlines[taskText] = timestamp;
        localStorage.setItem("deadlines", JSON.stringify(deadlines));

        alert("Deadline set!");
    });

    // Clear task button
    const clearBtn = document.createElement("button");
    clearBtn.textContent = "Clear Task";
    clearBtn.className = "clearBtn";

    clearBtn.addEventListener("click", function () {
        const confirmDelete = confirm("Are you sure you want to clear this task?");
        if (confirmDelete) {
            list.removeChild(li);
            tasks = tasks.filter(t => t !== taskText);
            delete deadlines[taskText];
            localStorage.setItem("tasks", JSON.stringify(tasks));
            localStorage.setItem("deadlines", JSON.stringify(deadlines));
        }
    });

    li.appendChild(deadlineBtn);
    li.appendChild(clearBtn);
    list.appendChild(li);
}

// Load saved tasks on page start
tasks.forEach(createTask);

// Add new task
button.addEventListener("click", function(e) {
    e.preventDefault();

    const taskText = input.value.trim();
    if (taskText === "") return;

    tasks.push(taskText);
    localStorage.setItem("tasks", JSON.stringify(tasks));

    createTask(taskText);
    input.value = "";
});

// >>> Reminder checker (works only when tab is open) <<<
setInterval(() => {
    let now = Date.now();

    for (let task in deadlines) {
        if (now >= deadlines[task]) {
            new Notification("Task Reminder!", { body: task });

            delete deadlines[task];
            localStorage.setItem("deadlines", JSON.stringify(deadlines));
        }
    }
}, 1000); // check every 1 second

</script>

</body>
</html>